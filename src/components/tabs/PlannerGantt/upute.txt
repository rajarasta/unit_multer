# ğŸ“š Gantt Chart - Napredni Hover Sustav
## TehniÄka Dokumentacija i Upute za Integraciju

---

## ğŸ“‹ SadrÅ¾aj

1. [Pregled Sustava](#pregled-sustava)
2. [Arhitektura RjeÅ¡enja](#arhitektura-rjeÅ¡enja)
3. [Implementacija - Korak po Korak](#implementacija)
4. [API Referenca](#api-referenca)
5. [Testiranje](#testiranje)
6. [Troubleshooting](#troubleshooting)

---

## ğŸ¯ Pregled Sustava

### Cilj Integracije
Unaprijediti postojeÄ‡i Gantt chart s naprednim hover sustavom koji omoguÄ‡ava:
- **Vizualno bogat prikaz** statusa montaÅ¾e
- **Multi-level hover** interakciju (mali â†’ veliki â†’ dock-ovi)
- **Segmentirani progress** prikaz (analogno satu)
- **Ambient glow** za kritiÄne statuse

### Komponente Sustava

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          GANTT CHART VIEW               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚     TaskBar Component           â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚
â”‚  â”‚  â”‚Ring  â”‚ â”‚  Task Bar     â”‚     â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                â†“ hover                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚    UnifiedGanttHoverCard       â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”     â”‚     â”‚
â”‚  â”‚  â”‚Left â”‚   Main   â”‚Rightâ”‚     â”‚     â”‚
â”‚  â”‚  â”‚Dock â”‚   Card   â”‚Dock â”‚     â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ Arhitektura RjeÅ¡enja

### Podatkovna Struktura

```javascript
// ProÅ¡ireni Task Model
interface EnhancedTask {
  // PostojeÄ‡i podaci
  id: string;
  naziv: string;
  pozicija: string;
  proces: string;
  status: string;
  start: Date;
  end: Date;
  
  // NOVO: MontaÅ¾a status
  montazaStatus: {
    transport: boolean;
    ugradnja: boolean;
    stakljenje: boolean;
    brtvljenje: boolean;
    dodaci: boolean;
    zavrseno: boolean;
    reklamacija: boolean;
    blokirano: boolean;
  };
  
  // NOVO: Komadi/Pieces
  pieces: Array<{
    id: number;
    pieceNumber: number;
    processData: {
      comments: Comment[];
      documents: Document[];
      tasks: Subtask[];
    };
    montaza: MontazaSubStatus;
  }>;
}
```

### Komponente Hijerarhija

```
PlannerGanttTab.jsx
â”œâ”€â”€ TaskBar.jsx (modificiran)
â”‚   â”œâ”€â”€ MontazaProgressRing.jsx (novo)
â”‚   â””â”€â”€ StatusPill.jsx (novo)
â”œâ”€â”€ UnifiedGanttHoverCard.jsx (novo)
â”‚   â”œâ”€â”€ LeftDockSystem.jsx
â”‚   â”‚   â”œâ”€â”€ PrimaryDock.jsx
â”‚   â”‚   â”œâ”€â”€ SecondaryDock.jsx
â”‚   â”‚   â””â”€â”€ TertiaryDock.jsx
â”‚   â”œâ”€â”€ MainHoverContent.jsx
â”‚   â””â”€â”€ RightDockSystem.jsx
â”‚       â”œâ”€â”€ CommentsPanel.jsx
â”‚       â”œâ”€â”€ AttachmentsPanel.jsx
â”‚       â”œâ”€â”€ TasksPanel.jsx
â”‚       â””â”€â”€ HistoryPanel.jsx
â””â”€â”€ services/
    â””â”€â”€ MontazaDataService.js (novo)
```

---

## ğŸ› ï¸ Implementacija

### FAZA 1: Priprema Podatkovne Strukture

#### Korak 1.1: Kreirati Data Service

```javascript
// services/MontazaDataService.js
export class MontazaDataService {
  /**
   * Ekstraktira montaÅ¾a status iz procesa
   * @param {Object} task - Task objekt
   * @returns {Object} MontaÅ¾a status
   */
  static extractMontazaStatus(task) {
    // Logika za mapiranje process â†’ montaÅ¾a status
    const montazaMap = {
      'transport': task.processes?.transport?.completed || false,
      'ugradnja': task.processes?.ugradnja?.completed || false,
      // ... ostali
    };
    
    return montazaMap;
  }
  
  /**
   * Kreira piece strukturu iz pozicije
   * @param {string} positionId 
   * @returns {Array} Pieces array
   */
  static mapPositionToPieces(positionId) {
    // Implementacija mapiranja
  }
}
```

#### Korak 1.2: ProÅ¡iriti Task Objekte

```javascript
// U PlannerGanttTab.jsx
import { MontazaDataService } from './services/MontazaDataService';

const enrichTasks = useCallback((tasks) => {
  return tasks.map(task => ({
    ...task,
    montazaStatus: MontazaDataService.extractMontazaStatus(task),
    pieces: MontazaDataService.mapPositionToPieces(task.pozicija)
  }));
}, []);
```

---

### FAZA 2: Vizualne Komponente

#### Korak 2.1: Progress Ring Komponenta

```javascript
// components/MontazaProgressRing.jsx
import React from 'react';
import { motion } from 'framer-motion';

export function MontazaProgressRing({ 
  montazaStatus, 
  size = 'medium',
  showLabels = false 
}) {
  const SUBPROCESS_CONFIG = {
    transport: { color: '#3B82F6', label: 'Transport', angle: 0 },
    ugradnja: { color: '#8B5CF6', label: 'Ugradnja', angle: 60 },
    stakljenje: { color: '#06B6D4', label: 'Stakljenje', angle: 120 },
    brtvljenje: { color: '#10B981', label: 'Brtvljenje', angle: 180 },
    dodaci: { color: '#F59E0B', label: 'Dodaci', angle: 240 },
    zavrseno: { color: '#16A34A', label: 'ZavrÅ¡eno', angle: 300 }
  };
  
  const radius = size === 'small' ? 12 : size === 'medium' ? 20 : 28;
  
  return (
    <svg width={radius * 2 + 4} height={radius * 2 + 4}>
      {/* Implementacija segmenata */}
    </svg>
  );
}
```

#### Korak 2.2: Status Pill Komponenta

```javascript
// components/StatusPill.jsx
export function StatusPill({ 
  text, 
  hasProblems, 
  glowColor 
}) {
  return (
    <motion.div className="status-pill">
      {hasProblems && (
        <div className="glow-effect" style={{ backgroundColor: glowColor }} />
      )}
      <div className="pill-content">
        {text}
      </div>
    </motion.div>
  );
}
```

---

### FAZA 3: Unified Hover Card

#### Korak 3.1: Glavni Hover Wrapper

```javascript
// components/UnifiedGanttHoverCard.jsx
import React, { useState, useRef, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { LeftDockSystem } from './docks/LeftDockSystem';
import { RightDockSystem } from './docks/RightDockSystem';

export function UnifiedGanttHoverCard({
  task,
  position,
  level,
  onClose,
  onEdit,
  onUpdateTask,
  projectService,
  projectId
}) {
  const [dockLeft, setDockLeft] = useState(null);
  const [dockRight, setDockRight] = useState(null);
  const [scope, setScope] = useState('piece'); // 'piece' | 'position'
  
  // Hover card dimenzije prema levelu
  const dimensions = {
    1: { width: 320, height: 220 }, // Mali hover
    2: { width: 480, height: 380 }, // Veliki hover
    3: { width: 480, height: 380 }  // Sa dock-ovima
  };
  
  return (
    <motion.div
      className="unified-hover-card"
      initial={{ opacity: 0, scale: 0.9 }}
      animate={{ opacity: 1, scale: 1 }}
      exit={{ opacity: 0, scale: 0.9 }}
    >
      {/* Lijevi dock sustav */}
      {level >= 3 && (
        <LeftDockSystem
          task={task}
          onProcessSelect={setDockLeft}
        />
      )}
      
      {/* Glavni sadrÅ¾aj */}
      <MainCard
        task={task}
        dimensions={dimensions[level]}
        showControls={level >= 2}
      />
      
      {/* Desni dock sustav */}
      {level >= 2 && (
        <RightDockSystem
          type={dockRight}
          scope={scope}
          data={task}
          onScopeChange={setScope}
        />
      )}
    </motion.div>
  );
}
```

---

### FAZA 4: Integracija u Gantt

#### Korak 4.1: Modificirati TaskBar

```javascript
// U TaskBar komponenti (PlannerGanttTab.jsx)
const TaskBar = React.memo(function TaskBarInner({ task, rowIndex }) {
  // ... postojeÄ‡i kod ...
  
  return (
    <>
      {/* NOVO: Progress ring */}
      {task.montazaStatus && (
        <div 
          className="absolute"
          style={{ 
            left: x - 20, 
            top: y + height/2 - 10 
          }}
        >
          <MontazaProgressRing 
            montazaStatus={task.montazaStatus}
            size="small"
          />
        </div>
      )}
      
      {/* PostojeÄ‡i task bar */}
      <div className="task-bar">
        {/* ... */}
      </div>
      
      {/* NOVO: Status pill */}
      {task.montazaStatus?.reklamacija && (
        <StatusPill
          text="!"
          hasProblems={true}
          glowColor="#DC2626"
        />
      )}
    </>
  );
});
```

#### Korak 4.2: Zamijeniti Hover Komponentu

```javascript
// U PlannerGanttTab.jsx
import { UnifiedGanttHoverCard } from './components/UnifiedGanttHoverCard';

// Umjesto:
// <AdvancedTaskHoverCard ... />

// Koristi:
<AnimatePresence>
  {hoveredTask && (
    <UnifiedGanttHoverCard
      task={enrichedHoveredTask}
      position={hoveredTask.position}
      level={hoverLevel}
      onClose={handleCloseHover}
      onEdit={handleEditTask}
      onUpdateTask={updateTask}
      projectService={projectService}
      projectId={activeProjectId}
    />
  )}
</AnimatePresence>
```

---

## ğŸ“¡ API Referenca

### MontazaDataService

| Metoda | Parametri | Povrat | Opis |
|--------|-----------|--------|------|
| `extractMontazaStatus` | `task: Object` | `Object` | IzvlaÄi montaÅ¾a status |
| `mapPositionToPieces` | `positionId: string` | `Array` | Mapira poziciju u komade |
| `calculateProgress` | `montazaStatus: Object` | `number` | RaÄuna postotak zavrÅ¡enosti |

### UnifiedGanttHoverCard Props

| Prop | Tip | Obavezno | Opis |
|------|-----|----------|------|
| `task` | `Object` | âœ… | Task objekt s proÅ¡irenim podacima |
| `position` | `{x, y}` | âœ… | Pozicija za prikaz |
| `level` | `1\|2\|3` | âœ… | Razina hover prikaza |
| `onClose` | `Function` | âœ… | Callback za zatvaranje |
| `onEdit` | `Function` | âŒ | Callback za ureÄ‘ivanje |

---

## ğŸ§ª Testiranje

### Unit Testovi

```javascript
// __tests__/MontazaDataService.test.js
describe('MontazaDataService', () => {
  test('should extract montaza status correctly', () => {
    const task = { /* mock data */ };
    const status = MontazaDataService.extractMontazaStatus(task);
    expect(status.transport).toBe(true);
  });
});
```

### Integracija Testovi

```javascript
// __tests__/GanttHoverIntegration.test.js
describe('Gantt Hover Integration', () => {
  test('should show progress ring on task hover', async () => {
    // Test implementacija
  });
});
```

### RuÄno Testiranje - Checklist

- [ ] Progress ring se prikazuje na hover
- [ ] Segmenti se ispravno boje prema statusu
- [ ] Glow efekt radi za reklamacije/blokade
- [ ] Dock-ovi se otvaraju/zatvaraju glatko
- [ ] Scope switching (komad/pozicija) radi
- [ ] Performance je prihvatljiv (60fps)
- [ ] Nema memory leak-ova

---

## ğŸ”§ Troubleshooting

### Problem: Hover se ne prikazuje

**RjeÅ¡enje:**
```javascript
// Provjeri z-index hijerarhiju
.unified-hover-card {
  z-index: 9999; /* Mora biti iznad svega */
}
```

### Problem: Segmenti se krivo prikazuju

**RjeÅ¡enje:**
```javascript
// Provjeri SVG viewBox i koordinate
const centerX = radius + strokeWidth/2;
const centerY = radius + strokeWidth/2;
```

### Problem: Performance problemi

**RjeÅ¡enje:**
1. Koristi `React.memo` za TaskBar
2. Implementiraj virtualizaciju za velike liste
3. Debounce hover eventi:

```javascript
const debouncedHover = useMemo(
  () => debounce(handleHover, 100),
  [handleHover]
);
```

---

## ğŸ“š Dodatni Resursi

### Datoteke za Download
- [MontazaProgressRing.jsx](./components/MontazaProgressRing.jsx)
- [UnifiedGanttHoverCard.jsx](./components/UnifiedGanttHoverCard.jsx)
- [MontazaDataService.js](./services/MontazaDataService.js)

### Korisni Linkovi
- [Framer Motion Docs](https://www.framer.com/motion/)
- [React Performance](https://react.dev/learn/render-and-commit)
- [SVG Path Tutorial](https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths)

### Kontakt za PodrÅ¡ku
- Email: dev-team@example.com
- Slack: #gantt-hover-integration
- GitHub Issues: [Link to repo]

---

## ğŸ“ˆ Roadmap

### v1.0 - Osnovna Integracija âœ…
- [x] Progress ring vizualizacija
- [x] Osnovni hover sa 2 razine
- [x] Status pill komponenta

### v1.1 - Napredne ZnaÄajke ğŸš§
- [ ] Dock sustav
- [ ] Scope switching
- [ ] Animirani prijelazi

### v1.2 - Optimizacija ğŸ“…
- [ ] Performance tuning
- [ ] Lazy loading dock-ova
- [ ] Caching strategija

### v2.0 - BuduÄ‡e MoguÄ‡nosti ğŸ’¡
- [ ] AI-powered status predviÄ‘anje
- [ ] 3D vizualizacija progress-a
- [ ] Real-time kolaboracija

---

## ğŸ“ Changelog

### [1.0.0] - 2025-01-10
- Inicijalna verzija dokumentacije
- Dodane osnovne komponente
- Implementiran progress ring

### [0.9.0] - 2025-01-09
- Draft verzija
- Proof of concept

---

## ğŸ“„ Licenca

MIT License - Slobodno koristite i modificirajte

---

*Dokumentacija verzija: 1.0.0*  
*Zadnje aÅ¾uriranje: 10.01.2025*  
*Autor: Development Team*